/* ================= TRANSLATIONS ================= */
const translations = {
    en: {
        nav_home: "Home", nav_services: "Services", nav_work: "Work", nav_team: "Team", nav_pricing: "Pricing",
        hero_badge: "#1 Digital Agency in BD",
        hero_prefix: "We Build",
        hero_desc: "Led by MD. SALMAN FARSI & Team. We transform ideas into high-performance digital reality using the latest technology.",
        btn_work: "View Projects", btn_quote: "Get a Quote",
        stat_proj: "Projects", stat_sat: "Satisfaction", stat_award: "Awards",
        scroll: "Scroll",
        tag_expert: "Expertise", title_service: "Our Services",
        serv_1_t: "Graphic Design", serv_1_d: "Strategic branding, logo design, and visual identities crafted by our design team.",
        serv_2_t: "Web Development", serv_2_d: "Blazing fast websites using React & Node.js. Optimized for SEO and performance.",
        serv_3_t: "UI/UX Design", serv_3_d: "We create intuitive user journeys that convert visitors into loyal customers.",
        serv_4_t: "Software Dev", serv_4_d: "Scalable enterprise software architectures designed for complex business needs.",
        tag_port: "Portfolio", title_work: "Selected Works",
        tag_team: "The Squad", title_team: "Meet The Experts", view_port: "Portfolio",
        team_1_name: "MD. SALMAN FARSI", team_1_role: "Project Lead, Frontend Design", team_leader_label: "(Team Leader)",
        team_2_name: "SUMAIYA", team_2_role: "Content Management",
        team_3_name: "MD. MAHIDUL ISLAM", team_3_role: "Responsive Layout Dev",
        team_4_name: "HASAN REZA", team_4_role: "Testing & Deployment",
        team_5_name: "MD. SIFAT MOLLA", team_5_role: "Graphic Designer",
        tag_price: "Pricing", title_price: "Flexible Plans",
        plan_1: "Starter", plan_2: "Business", plan_3: "Enterprise",
        badge_pop: "Popular", price_cust: "Custom",
        feat_web: "Basic Website", feat_mob: "Mobile Responsive", feat_seo: "Basic SEO",
        feat_dyn: "Dynamic Website", feat_cms: "CMS Integration", feat_logo: "Logo Design",
        feat_soft: "Custom Software", feat_cloud: "Cloud Architecture", feat_supp: "24/7 Support",
        btn_choose: "Choose Plan", btn_contact: "Contact Us",
        contact_t: "Get In Touch", contact_d: "Ready to start? Fill out the form or contact us directly.",
        addr: "Gulshan-1, Dhaka-1212",
        form_name: "Your Name", form_email: "Email Address", form_msg: "Your Message", form_send: "Send Message",
        footer_desc: "We are a team of creators, engineers, and dreamers building the digital future. Trust us with your vision.",
        ft_comp: "Company", ft_serv: "Services", ft_news: "Newsletter", ft_copy: "All Rights Reserved.", ft_priv: "Privacy", ft_term: "Terms"
    },
    bn: {
        nav_home: "হোম", nav_services: "সেবা", nav_work: "কাজ", nav_team: "টিম", nav_pricing: "প্যাকেজ",
        hero_badge: "বাংলাদেশের সেরা ডিজিটাল এজেন্সি",
        hero_prefix: "আমরা তৈরি করি",
        hero_desc: "মোঃ সালমান ফারসি এবং টিমের নেতৃত্বে, আমরা আপনার আইডিয়াকে অত্যাধুনিক প্রযুক্তির মাধ্যমে ডিজিটাল বাস্তবে রূপান্তর করি।",
        btn_work: "প্রজেক্ট দেখুন", btn_quote: "কোটেশন নিন",
        stat_proj: "প্রজেক্ট", stat_sat: "সন্তুষ্টি", stat_award: "পুরস্কার",
        scroll: "স্ক্রল",
        tag_expert: "দক্ষতা", title_service: "আমাদের সেবাসমূহ",
        serv_1_t: "গ্রাফিক ডিজাইন", serv_1_d: "আমাদের ডিজাইন টিমের নেতৃত্বে লোগো এবং ভিজ্যুয়াল ব্র্যান্ডিং যা আপনার ব্যবসাকে আলাদা করে।",
        serv_2_t: "ওয়েব ডেভেলপমেন্ট", serv_2_d: "React এবং Node.js দিয়ে তৈরি দ্রুত গতির ওয়েবসাইট। এসইও এবং পারফরমেন্সের জন্য অপ্টিমাইজড।",
        serv_3_t: "UI/UX ডিজাইন", serv_3_d: "আমরা সহজ ও সুন্দর ডিজাইন তৈরি করি যা ভিজিটরদের কাস্টমারে পরিণত করে।",
        serv_4_t: "সফটওয়্যার ডেভেলপমেন্ট", serv_4_d: "জটিল ব্যবসায়িক প্রয়োজনের জন্য ডিজাইন করা স্কেলেবল সফটওয়্যার আর্কিটেকচার।",
        tag_port: "পোর্টফোলিও", title_work: "বাছাইকৃত কাজসমূহ",
        tag_team: "আমাদের দল", title_team: "বিশেষজ্ঞদের সাথে পরিচিত হোন", view_port: "পোর্টফোলিও",
        team_1_name: "মোঃ সালমান ফারসি", team_1_role: "প্রজেক্ট লিড, ফ্রন্টএন্ড ডিজাইন", team_leader_label: "(টিম লিডার)",
        team_2_name: "সুমাইয়া", team_2_role: "কন্টেন্ট ম্যানেজমেন্ট",
        team_3_name: "মোঃ মাহিদুল ইসলাম", team_3_role: "রেসপন্সিভ লেআউট ডেভেলপমেন্ট",
        team_4_name: "হাসান রেজা", team_4_role: "টেস্টিং ও ডিপ্লয়মেন্ট",
        team_5_name: "মোঃ সিফাত মোল্লা", team_5_role: "গ্রাফিক ডিজাইনার",
        tag_price: "প্যাকেজ", title_price: "আমাদের প্ল্যানসমূহ",
        plan_1: "স্টার্টার", plan_2: "বিজনেস", plan_3: "এন্টারপ্রাইজ",
        badge_pop: "জনপ্রিয়", price_cust: "আলোচনা সাপেক্ষে",
        feat_web: "বেসিক ওয়েবসাইট", feat_mob: "মোবাইল রেসপন্সিভ", feat_seo: "বেসিক এসইও",
        feat_dyn: "ডায়নামিক ওয়েবসাইট", feat_cms: "CMS ইন্টিগ্রেশন", feat_logo: "লোগো ডিজাইন",
        feat_soft: "কাস্টম সফটওয়্যার", feat_cloud: "ক্লাউড আর্কিটেকচার", feat_supp: "২৪/৭ সাপোর্ট",
        btn_choose: "প্ল্যানটি নিন", btn_contact: "যোগাযোগ করুন",
        contact_t: "যোগাযোগ করুন", contact_d: "শুরু করতে প্রস্তুত? ফর্মটি পূরণ করুন বা সরাসরি কল করুন।",
        addr: "গুলশান-১, ঢাকা-১২১২",
        form_name: "আপনার নাম", form_email: "ইমেইল এড্রেস", form_msg: "আপনার বার্তা", form_send: "বার্তা পাঠান",
        footer_desc: "আমরা নির্মাতা ও প্রকৌশলীদের একটি দল যারা ডিজিটাল ভবিষ্যৎ গড়ছে। আপনার ভিশন আমাদের হাতে নিরাপদ।",
        ft_comp: "কোম্পানি", ft_serv: "সেবাসমূহ", ft_news: "নিউজলেটার", ft_copy: "সর্বস্বত্ব সংরক্ষিত।", ft_priv: "গোপনীয়তা", ft_term: "শর্তাবলী"
    }
};

let currentLang = 'en';

/* ================= LOADER & INIT ================= */
window.addEventListener('load', () => {
    document.getElementById('loader').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('loader').style.display = 'none';
        initTyping();
    }, 500);
});

/* ================= LANGUAGE SWITCHER ================= */
const langBtn = document.getElementById('lang-toggle');
const i18nElements = document.querySelectorAll('[data-i18n]');

langBtn.addEventListener('click', () => {
    currentLang = currentLang === 'en' ? 'bn' : 'en';
    langBtn.innerText = currentLang === 'en' ? 'ENG' : 'বাংলা';
    i18nElements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if(translations[currentLang][key]) el.innerText = translations[currentLang][key];
    });
    updateTypingEffect();
});

/* ================= TYPING EFFECT ================= */
let typingInstance = null;
const enWords = '["Digital Empires", "Custom Software", "Modern Brands"]';
const bnWords = '["ডিজিটাল সাম্রাজ্য", "কাস্টম সফটওয়্যার", "আধুনিক ব্র্যান্ড"]';

class TxtRotate {
    constructor(el, toRotate, period) {
        this.toRotate = toRotate;
        this.el = el;
        this.loopNum = 0;
        this.period = parseInt(period, 10) || 2000;
        this.txt = '';
        this.tick();
        this.isDeleting = false;
        this.stop = false;
    }
    tick() {
        if(this.stop) return;
        let i = this.loopNum % this.toRotate.length;
        let fullTxt = this.toRotate[i];

        if (this.isDeleting) {
            this.txt = fullTxt.substring(0, this.txt.length - 1);
        } else {
            this.txt = fullTxt.substring(0, this.txt.length + 1);
        }

        this.el.innerHTML = '<span class="wrap">'+this.txt+'</span>';

        let delta = 200 - Math.random() * 100;
        if (this.isDeleting) delta /= 2;

        if (!this.isDeleting && this.txt === fullTxt) {
            delta = this.period;
            this.isDeleting = true;
        } else if (this.isDeleting && this.txt === '') {
            this.isDeleting = false;
            this.loopNum++;
            delta = 500;
        }
        setTimeout(() => { this.tick(); }, delta);
    }
}

function initTyping() {
    const el = document.querySelector('.txt-rotate');
    const words = JSON.parse(el.getAttribute('data-rotate'));
    typingInstance = new TxtRotate(el, words, 2000);
}

function updateTypingEffect() {
    const el = document.querySelector('.txt-rotate');
    if(typingInstance) typingInstance.stop = true;
    el.innerHTML = "";
    const newWords = currentLang === 'en' ? enWords : bnWords;
    typingInstance = new TxtRotate(el, JSON.parse(newWords), 2000);
}

/* ================= CURSOR ================= */
const cursor = document.getElementById('cursor');
const cursorBlur = document.getElementById('cursor-blur');
document.addEventListener('mousemove', (e) => {
    cursor.style.left = e.clientX + 'px';
    cursor.style.top = e.clientY + 'px';
    cursorBlur.animate({ left: e.clientX + "px", top: e.clientY + "px" }, { duration: 500, fill: "forwards" });
});
document.querySelectorAll('.hover-trigger').forEach(el => {
    el.addEventListener('mouseenter', () => document.body.classList.add('hovered'));
    el.addEventListener('mouseleave', () => document.body.classList.remove('hovered'));
});

/* ================= THEME TOGGLE ================= */
const themeSwitch = document.getElementById('theme-switch');
const currentTheme = localStorage.getItem('theme');
if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);
    if (currentTheme === 'light') themeSwitch.checked = true;
}
themeSwitch.addEventListener('change', (e) => {
    const theme = e.target.checked ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
});

/* ================= SCROLL SPY (FIXED) ================= */
const scrollLine = document.querySelector('.scroll-line');
const navbar = document.getElementById('navbar');
const navLinks = document.querySelectorAll('.nav-link');
const sections = document.querySelectorAll('section');

window.addEventListener('scroll', () => {
    // Scroll Progress
    let scrollTop = document.documentElement.scrollTop;
    let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    let scrolled = (scrollTop / height) * 100;
    if(scrollLine) scrollLine.style.width = scrolled + '%';

    // Sticky Nav
    if (scrollTop > 50) navbar.classList.add('scrolled');
    else navbar.classList.remove('scrolled');

    // Scroll Spy
    let current = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (pageYOffset >= (sectionTop - 250)) { // Adjusted offset
            current = section.getAttribute('id');
        }
    });

    navLinks.forEach(link => {
        link.classList.remove('active');
        if (current && link.getAttribute('href').includes(current)) {
            link.classList.add('active');
        }
    });
});

/* ================= ANIMATION OBSERVER ================= */
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            if (entry.target.classList.contains('counter')) startCounter(entry.target);
        }
    });
}, { threshold: 0.1 });
document.querySelectorAll('.fade-up, .fade-scroll, .counter').forEach(el => observer.observe(el));

function startCounter(el) {
    const target = +el.getAttribute('data-target');
    let count = 0;
    const inc = target / 100;
    const update = () => {
        count += inc;
        if (count < target) {
            el.innerText = Math.ceil(count);
            requestAnimationFrame(update);
        } else {
            el.innerText = target + '+';
        }
    };
    update();
}

/* ================= 3D BACKGROUND ================= */
const canvas = document.getElementById('webgl');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
const geo = new THREE.BufferGeometry();
const count = 400; const pos = new Float32Array(count * 3);
for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*15;
geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
const mat = new THREE.PointsMaterial({ size: 0.02, color: 0x4f46e5 });
const mesh = new THREE.Points(geo, mat);
scene.add(mesh);
camera.position.z = 2;

let mouseX = 0; let mouseY = 0;
document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX / window.innerWidth - 0.5;
    mouseY = e.clientY / window.innerHeight - 0.5;
});
function animate() {
    requestAnimationFrame(animate);
    mesh.rotation.y += 0.001;
    mesh.rotation.x += (mouseY * 0.3 - mesh.rotation.x) * 0.05;
    mesh.rotation.y += (mouseX * 0.3 - mesh.rotation.y) * 0.05;
    renderer.render(scene, camera);
}
animate();
window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

/* ================= MOBILE MENU & FILTERS ================= */
const hamburger = document.querySelector('.hamburger');
const navMenu = document.querySelector('.nav-menu');

hamburger.addEventListener('click', () => {
    navMenu.classList.toggle('active');
});

// Close menu when link is clicked
document.querySelectorAll('.nav-link').forEach(n => n.addEventListener('click', () => {
    navMenu.classList.remove('active');
}));

// Portfolio Filter
const filterBtns = document.querySelectorAll('.filter-btn');
const items = document.querySelectorAll('.portfolio-item');
filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelector('.filter-btn.active').classList.remove('active');
        btn.classList.add('active');
        const filter = btn.getAttribute('data-filter');
        items.forEach(item => {
            if (filter === 'all' || item.classList.contains(filter)) {
                item.style.display = 'block';
                setTimeout(() => item.style.opacity = '1', 100);
            } else {
                item.style.opacity = '0';
                setTimeout(() => item.style.display = 'none', 300);
            }
        });
    });
});
